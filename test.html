<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
    body { font-family: sans-serif; padding: 2rem; text-align: center; }
    input, button, textarea { font-size: 1rem; padding: 0.4rem; margin: 0.4rem; }
    pre { background: #f4f4f4; padding: 1rem; border-radius: 8px; max-width: 800px; margin: 1rem auto; text-align: left; }
    .edit-box { display: flex; flex-direction: column; gap: 8px; margin: 1rem auto; width: 80%; max-width: 600px; }
    .edit-box div { display: flex; gap: 1rem; align-items: center; }
    .edit-box label { width: 180px; text-align: right; }
    .output-success { color: green; }
  </style>
</head>
<body>
  <div id="tokenInputContainer">
    <input type="password" id="tokenInput" placeholder="Enter Bearer Token" />
    <button onclick="saveToken()">Authorize</button>
  </div>

  <button onclick="getPrevWord()">Get Previous Word</button>
  <input type="number" id="wordId" placeholder="Enter word ID" />
  <button onclick="getWord()">Get Word</button>
  <button onclick="getNextWord()">Get Next Word</button>

  <div id="translationsEditor" class="edit-box" style="display:none;"></div>
  <button id="saveBtn" onclick="saveTranslations()" style="display:none;">Save Translations</button>

  <script>
    function getPrevWord() {
      const input = document.getElementById('wordId');
      let id = parseInt(input.value || '0', 10);
      if (isNaN(id)) id = 0;
      input.value = id - 1;
      getWord();
    }

    function getNextWord() {
      const input = document.getElementById('wordId');
      let id = parseInt(input.value || '0', 10);
      if (isNaN(id)) id = 0;
      input.value = id + 1;
      getWord();
    }

    function saveToken() {
      const token = document.getElementById('tokenInput').value;
      sessionStorage.setItem('bearerToken', token);
    }

    async function getWord() {
      const token = sessionStorage.getItem('bearerToken');
      const id = document.getElementById('wordId').value;
      const output = document.getElementById('output');
      const editor = document.getElementById('translationsEditor');
      const saveBtn = document.getElementById('saveBtn');

      if (!token) {
        output.textContent = "❌ Please authorize first.";
        return;
      }

      editor.style.display = "none";
      saveBtn.style.display = "none";
      editor.innerHTML = "";

      try {
        const res = await fetch(`https://213.89.2.214:7018/api/words/${id}`, {
          headers: {
            'Authorization': 'Bearer ' + token
          }
        });

        if (!res.ok) throw new Error("Unauthorized or Not Found");

        const data = await res.json();

        if (data.translations && typeof data.translations === 'string') {
          const parsed = JSON.parse(data.translations);
        
          const displayOrder = [
            'wordClass',
            'en_US word',
            'ur_PK word',
            'en_US sentence',
            'ur_PK sentence'
          ];
        
displayOrder.forEach(key => {
  const value = parsed[key] ?? '';
  const isReadOnly = key === 'wordClass' || key === 'en_US word';
  const row = document.createElement('div');
  row.innerHTML = `
    <label>${key}</label>
    <input type="text" name="${key}" value="${value}" ${isReadOnly ? 'readonly' : ''} />
  `;
  editor.appendChild(row);
});

        
          editor.style.display = "flex";
          saveBtn.style.display = "inline-block";
        }
      } catch (err) {
        output.textContent = "❌ Error: " + err.message;
      }
    }

    function saveTranslations() {
      const inputs = document.querySelectorAll('#translationsEditor input');
      const updated = {};
      inputs.forEach(input => {
        updated[input.name] = input.value;
      });

      const jsonString = JSON.stringify(updated, null, 2);
      const output = document.getElementById('output');
      output.textContent = "✅ New Translations JSON:\n" + jsonString;
      output.classList.add('output-success');

      // You can now send jsonString back to the API using fetch(POST) if needed.
      console.log("Ready to POST:", jsonString);
    }
  </script>
  <pre id="output" style="display:none;"></pre>
</body>
</html>
